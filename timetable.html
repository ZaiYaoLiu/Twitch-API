<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css" integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2" crossorigin="anonymous">
    <script src="https://code.jquery.com/jquery-3.5.1.js"></script>
    <title>火車時刻表</title>

</head>
<body>
    
    <div class="main m-5">
        <form>
            <div class="form-row">
                起站:
                <select class="custom-select custom-select-lg mb-3" id="start"></select>
                終點:
                <select class="custom-select custom-select-lg mb-3" id="end"></select>                
            </div>
            <button type="button" class="btn btn-primary">查詢</button>
        </form>

        <div class="content mt-5">
            <table class="table table-hover">
                <thead>
                  <tr>
                    <th scope="col">車號</th>
                    <th scope="col">車種</th>
                    <th scope="col">起點(離站)</th>
                    <th scope="col">終點(到站)</th>
                  </tr>
                </thead>
                <tbody class="info">
                  
                </tbody>
              </table>
        </div>        
    </div>




    <script>
        var start = 0;
        var end = 0;
        const year = new Date().getFullYear()
        const month = new Date().getMonth() + 1
        const date = new Date().getDate()
        const time =  year+ "-" + month + "-" + date

        function getTrainStation() {
            fetch('https://ptx.transportdata.tw/MOTC/v2/Rail/TRA/Station', {
                method: 'GET'
            })
            .then((data) => {
                data.json()
                .then(Station => {
                    for (let info of Station) {
                        $('.custom-select').append(`
                            <option value="${info.StationID}">${info.StationName.Zh_tw}</option>
                        `)
                    }
                })
            }).catch((err) => {
                console.log('Error', err);
            })         
        }

        function getTimetable(start, end, time) {
            fetch(`https://ptx.transportdata.tw/MOTC/v2/Rail/TRA/DailyTimetable/OD/${start}/to/${end}/${time}`, {
                method: 'GET'
            })
            .then((data) => {
                data.json()
                .then(table => {
                    for (let info of table) {
                        $('.info').append(`
                            <tr>
                                <th scope="row">${info.DailyTrainInfo.TrainNo}</th>
                                <td>${info.DailyTrainInfo.TrainTypeName.Zh_tw}</td>
                                <td>${info.OriginStopTime.StationName.Zh_tw}(${info.OriginStopTime.DepartureTime})</td>
                                <td>${info.DestinationStopTime.StationName.Zh_tw}(${info.DestinationStopTime.ArrivalTime})</td>
                            </tr>
                        `)}
                })
            }).catch((err) => {
                console.log('Error', err);
            })         
        }
        getTrainStation()

        $(".btn").click(() => {
            start = $("#start").val()
            end = $("#end").val()
            getTimetable(start, end, time)
        })
        

    </script>    
</body>
</html>